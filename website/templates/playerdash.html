{% extends "base.html" %} {% block title %}Home{% endblock %} 
{% block content%} 

<body style="background-image: none;" class="light-mode">

<div class="container mt-4">
  <div class="row">
    <div class="col-lg-4 mb-4">
      <div class="card">
        <div class="card-body">
          <h5 class="card-title">Profile Details</h5>

          <h6>You are logged in as:</h6> {{ current_user.Username }} </br>
          <h6>Your Email Address is:</h6> {{ current_user.Email }} </br>
          <h6>Your Forename is:</h6> {{ current_user.Forename }} </br>
          <h6>Your Surname is:</h6> {{ current_user.Surname }} </br>
          <h6>You Role is:</h6> {{ current_user.Role }} </br>
        </div>
      </div>
    </div>
    <div class="col-lg-4 mb-4">
      <div class="card">
        <div class="card-body">
          <!-- <h5 class="card-title">Player ratings for: {{ current_user.Forename }}</h5> -->
          <h5 class="card-title">Coach Ratings Over Time</h5>
          <!-- Check these for testing purposes
          {{datasets}}<br/><br/>
          {{final_data}}<br/><br/>
          {{categories}}<br/><br/>
          {{ratings_query}} -->
          

          <div id="chart-container">
            <canvas id="userRatingsChart" ></canvas>
          </div>


        </div>
      </div>
    </div>
    <div class="col-lg-4 mb-4">
      <div class="card">
        <div class="card-body">
          <h5 class="card-title">Latest Coach Ratings</h5>
          <table id="example" class="table table-striped" style="width:100%">
              <tr>
                  <th>Category</th>
                  <th>Value ( / 10)</th>
              </tr>
              {% for rating, date, category in filtered_data %}
                  <tr>
                      <!-- need to figure out here how to present the LATEST/MOST RECENT scores per category -->
                      <td>{{ category }}</td>
                      <td>{{ rating }}</td>
                  </tr>
              {% endfor %}
          </table>
        </div>
      </div>
    </div>
  </div>
</div>



<script>
  // Python data structure (final_data) passed from the server
  // const final_data = {{final_data}}
  const final_data = {{ final_data | tojson | safe }};
  // Extracting data from final_data
  const labels = final_data[0].Date;
  const datasets = final_data.map(entry => ({
      label: entry.Category,
      data: entry.Value,
      fill: false,
      borderColor: '#' + (Math.random().toString(16) + '000000').substring(2, 8) // Random color
  }));

  // Create the chart
  const ctx = document.getElementById('userRatingsChart').getContext('2d');
  const myChart = new Chart(ctx, {
      type: 'line',
      data: {
          labels: labels,
          datasets: datasets
      },
      options: {
        responsive: true,
          maintainAspectRatio: false,
          aspectRatio: 0.9, // Set a custom aspect ratio (e.g., 2:1)
          scales: {
              y: {
                  min: 0,
                  max: 10,
                  ticks: {
                      stepSize: 1
                  }
              }
          }
      }
  });
</script>










{% endblock %}




<!-- <script>
  // Extract data from Python variable to JavaScript
  const dataStructure = {{ datasets | tojson | safe }};
  console.log(dataStructure); // Log the value to the console for debugging

  // Extract categories, values, and dates dynamically
  const categories = [];
  const datasets = [];
  let allDates = []; // Array to hold all dates for all categories
  

  dataStructure.forEach(item => {
      categories.push(item.Category);

      // Extract dates for this category
      const dates = item.Date;
      allDates = allDates.concat(dates); // Add dates to allDates array
      console.log("All dates:",allDates); // Log the value to the console for debugging

      // Create dataset for this category
      datasets.push({
          label: item.Category,
          data: item.Value,
          // generate random colours for the lines each time
          borderColor: false,
          fill: '#' + (Math.random() * 0xFFFFFF << 0).toString(16), // Random border color
      });
  });

  // Deduplicate dates and sort them
  const uniqueDates = Array.from(new Set(allDates)).sort();
  console.log("Uni dates:",uniqueDates); // Log the value to the console for debugging
  console.log("DATASETS:",datasets); // Log the value to the console for debugging

  // Create Chart.js line graph
  const ctx = document.getElementById('userRatingsChart').getContext('2d');
  const lineChart = new Chart(ctx, {
      type: 'line',
      data: {
          labels: uniqueDates,
          datasets: datasets
      },
      options: {
          responsive: true,
          maintainAspectRatio: false,
          aspectRatio: 0.9, // Set a custom aspect ratio (e.g., 2:1)
          scales: {
              x: {
                  display: true,
                  title: {
                      display: true,
                      text: 'Date'
                  }
              },
              y: {
                  display: true,
                  title: {
                      display: true,
                      text: 'Value'
                  },
                  suggestedMin: 0, // Adjust min value as needed
                  suggestedMax: 10 // Adjust max value as needed
              }
          }
      }
  });
</script> -->


<!-- <script>
  var ctx = document.getElementById('userRatingsChart').getContext('2d');
  var myChart = new Chart(ctx, {
      type: 'line', // Change to 'line', 'pie', etc., as needed
      data: {
          labels: {{ categories | tojson | safe }},
          datasets: [{
              label: 'User Ratings',
              data: {{ ratings | tojson | safe }},
              backgroundColor: [
                  'rgba(255, 99, 132, 0.2)',
                  'rgba(54, 162, 235, 0.2)',
                  'rgba(255, 206, 86, 0.2)',
                  // Add more colors as needed
              ],
              borderColor: [
                  'rgba(255, 99, 132, 1)',
                  'rgba(54, 162, 235, 1)',
                  'rgba(255, 206, 86, 1)',
                  // Add more colors as needed
              ],
              borderWidth: 1
          }]
      },
      options: {
          scales: {
              y: {
                  beginAtZero: true
              }
          }
      }
  });
</script> -->
